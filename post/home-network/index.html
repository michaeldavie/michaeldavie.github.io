<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Michael Davie's Blog"><meta property="og:type" content="article"><meta property="og:image" content="https://michaeldavie.github.io//img/home-bg-jeep.jpg"><meta property="twitter:image" content="https://michaeldavie.github.io//img/home-bg-jeep.jpg"><meta name=title content="Our Overly Complex Home LAN"><meta property="og:title" content="Our Overly Complex Home LAN"><meta property="twitter:title" content="Our Overly Complex Home LAN"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="twitter:card" content="summary"><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Our Overly Complex Home LAN | Michael Davie Blog</title>
<link rel=canonical href=/post/home-network/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Michael Davie's Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/home-bg-jeep.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Our Overly Complex Home LAN</h1><h2 class=subheading></h2><span class=meta>Posted by
Michael Davie
on
Monday, April 18, 2022</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h2 id=our-overly-complex-home-lan>Our Overly Complex Home LAN</h2><p>Over the years, our home network has grown increasingly complex. It&rsquo;s fairly stable at this point, and I think reasonably secure as well. Here&rsquo;s a breakdown.</p><h3 id=physical>Physical</h3><p><img src=images/physical.png alt=physical-network></p><p>The edge of our network is the combined fiber modem / wireless router provided by our ISP. We basically use it as a modem, and put our real router in its DMZ.</p><p>The core of the network is a Ubiquiti <a href=https://store.ui.com/collections/operator-edgemax-routers/products/edgerouter-x>EdgeRouter X</a>. It&rsquo;s an inexpensive but full-featured 5-port gigabit router, and might be the best device out there for this kind of &ldquo;prosumer&rdquo; use case. The five ports are connected as follows:</p><ul><li>WAN uplink to modem</li><li>2 x Ubiquiti <a href=https://store.ui.com/collections/unifi-network-wireless>UniFi</a> wireless access points (an AC Long-range and a nanoHD)</li><li>Unmanaged 8-port switch, for wired IoT devices</li><li>Mac mini server</li></ul><p>There&rsquo;s also a Ubiquiti <a href=https://store.ui.com/collections/unifi-network-wireless/products/uap-beaconhd>BeaconHD</a> access point that is connected to the nanoHD via a wireless mesh link.</p><p>This setup has been great throughout the past couple years of pandemic-induced remote work and home school, including multiple simultaneous video calls. We typically have around 30 client devices connected to the wifi, and when we downgraded our WAN link to the slowest / cheapest plan available (125 Mbps down / 10 Mbps up), there was no perceptible change in performance.</p><h3 id=logical>Logical</h3><p><img src=images/logical.png alt=logical-network></p><p>Our network is logically divided into three zones, with a separate VLAN tag and wireless SSID for each:</p><ul><li>Core - This is where our main devices reside, including our laptops, tablets, and phones. The server and printer also reside in this zone, along with the Sonos speakers because they&rsquo;re just weird.</li><li>IoT - We have entirely too many smart devices on our network, and they&rsquo;re difficult to put much faith in security-wise. They live in their own zone to keep them away from everything else.</li><li>Guest - The guest zone is primarily used for our employer-managed devices, as well as the occasional actual guest.</li></ul><h3 id=network-security>Network Security</h3><p>Each zone has largely unrestricted access to the internet, except for the core and IoT zones which have a degree of content filtering. This is provided by a local <a href=https://github.com/AdguardTeam/AdGuardHome>AdGuard Home</a> DNS server, which blocks domains associated with advertising, tracking, and adult content.</p><p>Network flows between the zones are controlled via the EdgeRouter and are explicitly authorized. As shown in the diagram above, the following connections are the only ones allowed beyond internet access:</p><ul><li><a href=https://wireguard.com>Wireguard</a> VPN connections from the internet, which are forwarded to a container on the Mac mini server.</li><li>Any connections from the core zone to the IoT zone.</li><li>Connections from the IoT zone to the core zone for DNS, multicast DNS (mDNS), and to the <a href=https://www.home-assistant.io/>Home Assistant</a> container.</li><li>Connections from the <a href=https://rumble.run>Rumble</a> network scanner in the core zone to the guest zone.</li><li>Connections from the guest zone to the printer in the core zone.</li></ul><h3 id=networking-services>Networking Services</h3><p>I run a few networking-related services in containers on the Mac mini server:</p><ul><li>AdGuard Home (<a href=https://hub.docker.com/r/adguard/adguardhome>image</a>)</li><li>UniFi wireless network controller (<a href=https://hub.docker.com/r/jacobalberty/unifi>image</a>)</li><li>Cloudflare dynamic DNS updater (<a href=https://hub.docker.com/r/joshava/cloudflare-ddns/>image</a>)</li><li>Wireguard VPN server (<a href=https://hub.docker.com/r/linuxserver/wireguard>image</a>)</li><li>Rumble network scanner (<a href=https://www.rumble.run/docs/installing-an-explorer/#container-installations>config</a>)</li></ul><hr><ul class=pager><li class=previous><a href=/post/backups-photo-management/ data-toggle=tooltip data-placement=top title="Backups and Photo Management">&larr;
Previous Post</a></li><li class=next><a href=/post/blender-pipeline/ data-toggle=tooltip data-placement=top title="Blender Rendering Pipeline on AWS">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/michaeldavie><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/michael-davie-peng><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://keybase.io/michaeldavie><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-keybase fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Michael Davie's Blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>